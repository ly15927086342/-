Author: _Yu Li_  
date: _2020/07/18_

# 《图解HTTP》总结

## Chapter1 了解Web及网络基础

1. TCP/IP协议族各层的作用：

应用层：决定通信的活动，如FTP、HTTP和DNS

传输层：提供数据传输协议，如TCP和UDP

网络层：处理网络上流动的数据包，选择传输路线，即IP协议

链路层：硬件设备，如网卡、光纤等

2. TCP/IP通信传输流：客户端>HTTP>TCP>IP>网络>IP>TCP>HTTP>服务器

客户端每经过一层就加一个首部，服务器每经过一层就去掉一个首部信息。

3. 与HTTP密不可分的三个协议：IP、TCP、DNS

**IP**：两个重要部分是IP地址和MAC地址（Media Access Control Address)

IP地址指明节点被分配到的地址，MAC地址是指网卡所属固定地址。IP和MAC可配对，IP可变，MAC基本不变。

ARP协议（Address Resolution Protocol）可以解析地址，根据通信方的IP地址就可以反查出对应的MAC地址。

**TCP**：提供可靠的字节流服务（Byte Stream Service），即把大块数据分割成报文段（segment）为单位的数据包进行管理。

三次握手（Three-way handshaking）：发送端先发一个带SYN标志的数据包，接收端收到后回传一个带SYN/ACK标志的数据包表示传达缺人，最后发送方再回传一个带ACK标志的数据包，表示握手结束。若握手过程中某阶段中断，TCP会再次以相同顺序发送相同数据包。

**DNS**：提供域名和IP地址之间的解析服务

相比域名，计算机更擅长处理IP

4. URI和URL

URI用字符串标识某一互联网资源，而URL表示资源地点，所以URL是URI的子集。

## Chapter2 简单的HTTP协议

1. 请求报文是由请求方法、请求URI、协议版本、可选的请求首部字段和内容实体构成。

例如：　

	GET /index.htm HTTP/1.1
	Host: hackr.jp
	Connection: keep-alive
	Content-Length: 16
	...
	name=ueno&age=37

2. 响应报文是由协议版本、状态码、用以解释状态码的原因短语、可选的响应首部字段及实体主体构成。

例如：

	HTTP/1.1 200 OK
	Date: Tue, 10 Jul 2012 06:50:15 GMT
	Content-Length:362
	Content-Type: text/html
	...
	<html>
	...

3. HTTP是无状态协议（stateless），即协议对于发送过的请求或响应都不做持久化处理。但为了实现保持状态的功能，引入了Cookie技术。

4. HTTP方法

GET：获取资源

POST：传输实体主体

PUT：传输文件

HEAD：获得报文首部

DELETE：删除文件

OPTIONS：询问支持的方法

TRACE：追踪路径

CONNECT：要求用隧道协议连接代理

5. 持久连接节省通信量

因为一次HTTP通信就要断开一次TCP连接

HTTP keep-alive特点，只要任意一端没有明确提出断开连接，则保持TCP连接状态。

HTTP/1.1中所有连接默认都是`持久连接`，HTTP/1.0未标准化。好处在于减少了TCP连接的重复建立和断开造成的额外开销，减轻服务端的负载。

`管线化`（pipelining）：从前请求是串行的，管线化技术可以实现并行发送多个请求。

6. 使用Cookie的状态管理

Cookie会根据从服务器端发送的响应报文内的一个叫做Set-Cookie的首部字段信息，通知客户端保存Cookie，下次客户端再往该服务器发送请求，客户端会自动在请求报文中加入Cookie指后发送。服务端接收到Cookie会检查记录，得到之前的状态信息。

## Chapter3 HTTP报文内的HTTP信息

1. HTTP报文可分为报文首部和报文主体两块，由最初出现的空行（CR+LF）来划分。报文主体可以没有。

		请求报文首部：
		请求行
		请求首部字段
		通用首部字段
		实体首部字段
		其他

		响应报文首部：
		状态行
		响应首部字段
		通用首部字段
		实体首部字段
		其他

2. 编码提升传输速率

内容编码+分块传输

3. 发送多种数据的多部份对象集合

有以下几种Content-Type：

	multipart/form-data
	multipart/byteranges

4. 内容协商包括：服务器驱动协商、客户端驱动协商、透明协商

## Chapter4 返回结果的HTTP状态码

1. 状态码

||类别|原因短语|
|:--|:--|:--|
|1XX|Informational信息性|接收的请求正在处理|
|2XX|Success成功|请求正常处理完毕|
|3XX|Redirection重定向|需要进行附加操作已完成请求|
|4XX|Client Error客户端错误|服务器无法处理请求|
|5XX|server Error服务器错误|服务器处理请求出错|

2. 14个具体状态码

|状态码|含义|
|:--|:--|
|200|正常处理|
|204|处理成功，但没资源返回|
|206|处理成功，返回一部分资源|
|301|永久性重定向，资源被分配到新URI|
|302|临时重定向|
|303|URI已更新，应用GET方法请求新URI|
|304|资源找到，但未符合条件请求|
|307|临时重定向，同302|
|400|请求报文存在错误语法|
|401|第一次表示请求需要HTTP认证，第二次表示认证失败|
|403|拒绝访问|
|404|Not Found|
|500|服务器故障|
|503|服务器超负载或正在停机维护，无法处理请求|

## Chapter5 与HTTP协作的Web服务器

1. 单台虚拟主机实现多个域名，即IP绑多个域名

2. 通信数据转发程序：代理、网关、隧道

代理：是一种有转发功能的应用程序，接收客户端返送的请求并转发给服务器，同时也接收服务器返回的响应并转发给客户端

网关：转发其他服务器通信数据的服务器，接收从客户端发来的请求时，对请求进行转发

隧道：相隔很远的客户端和服务器两者之间中转，保持双方通信连接的应用程序

3. 使用代理服务器的理由：利用缓存技术减少网络带宽的流量，组织内部针对特定网站的访问控制等

4. 代理分类：

缓存代理：转发时预先将资源的副本保存在代理服务器，再次请求相同资源时，就不从源服务器获取资源，而是将之前的缓存资源作为响应返回

透明代理：不对报文做任何加工的代理

非透明代理：对报文内容加工的代理

5. 网关：工作机制和代理十分相似，而网关能使服务器提供非HTTP协议服务。利用网关可以提高通信的安全新，因为可以在客户端与网关之间通信线路上加密以确保连接的安全。网关可以连接数据库、和信用卡结算系统联动

6. 隧道：可按要求建立与其他服务器的通信线路，届时使用SSL等机密手段进行通信。目的是确保客户端能与服务器进行安全通信。隧道不解析HTTP请求，保持原样转发给服务器。

7. 保存资源的缓存

缓存指的是代理服务器或客户端本地磁盘内保存的资源副本。

缓存会因为客户端的要求、缓存的有效期等因素，向源服务器确认资源的有效性。若判断缓存失效，缓存服务器会再次从源服务器上获取新资源。

## Chapter6 HTTP首部

